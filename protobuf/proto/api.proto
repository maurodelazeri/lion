syntax = "proto3";
package api;
import "enum.proto";


// https://www.mql5.com/en/docs/standardlibrary/tradeclasses/ctrade/ctradepositionclose

// The API service definition.
service API {   
  // Get all Order for a user with filter - A server-to-client streaming RPC.
 // rpc GetOrders(OrderFilter) returns (stream Order) {}
  // Order request - A simple RPC 
  rpc OrderSend(OrderRequest) returns (OrderResult) {}
  rpc GetPositions(PositionRequest) returns (PositionsResult) {}
  rpc GetAccount(AccountRequest) returns (AccountResult) {}
  rpc GetProductDetails(ProductRequest) returns (ProductResult) {}
  rpc GetHistoticalTrades(HistoricalTradesRequest) returns (stream HistoricalTradesResult) {}
  rpc GetBacktestingToken(BacktestingTokenRequest) returns (BacktestingTokenResponse) {}
  rpc Backtesting(stream BacktestingRequest) returns (stream BacktestingResponse) {}
} 

  message Orders { 
    Venue                         venue                    = 1;  
    OrderType                     orders_type              = 2;  
    OrderState                    orders_state             = 3;  
    int64                         time_expiration          = 4;  
    int64                         time_setup               = 5;  
    OrderTypeFilling              orders_type_filling      = 6;  
    OrderTypeTime                 orders_type_time         = 7;  
    Reason                        orders_reason            = 8;   
    Product                       product                  = 9;  
    string                        venue_execution_id       = 10;  
    double                        volume                   = 11;  
    double                        price                    = 12;  
    double                        fee                      = 13;  
    string                        comment                  = 14;  
   }

 message OrderRequest { 
   TradeAction                   action               = 1;  // Trade operation type 
   Venue                         venue                = 2;  // Venue where the order is being send
   Product                       product              = 3;  // Trade product
   double                        volume               = 4;  // Requested volume for a deal in lots 
   double                        price                = 5;  // Price 
   double                        stoplimit            = 6;  // StopLimit level of the order 
   double                        sl                   = 7;  // Stop Loss level of the order 
   double                        tp                   = 8;  // Take Profit level of the order 
   double                        trailling_percent    = 9; // Once hit, follows to profit based on this percentage  
   double                        deviation            = 10; // Maximal possible deviation from the requested price 
   OrderType                     order_type           = 11; // Order type
   Side                          order_side           = 12; // Order side  
   OrderTypeFilling              order_type_filling   = 13; // Order execution type 
   OrderTypeTime                 order_type_time      = 14; // Order expiration type 
   Reason                        order_reason         = 15; // Order reason
   int64                         expiration           = 16; // Order expiration time (for the orders of ORDER_TIME_SPECIFIED type) 
   string                        comment              = 17; // Order comment 
   string                        position             = 18; // Position ticket 
  }

message OrderResult { 
   Retcode                      retcode                   = 1; // Operation return code    
   double                       price                     = 2; // Deal price, confirmed by broker
   double                       volume                    = 3; // Deal volume, confirmed by broker    
   double                       fee                       = 4; // Trade fee
   OrderState                   state                     = 5; // Order state
   string                       position_id               = 6; // position id placed 
   string                       broker_execution_id       = 7; // Return code of an external trading system 
   string                       comment                   = 8; // Broker comment to operation (by default it is filled by description of trade server return code)    
  }

message Position {
  string                        position_id              = 1;
	string                        account_id               = 2;
	Venue                         venue                    = 3; 
	Product                       product                  = 4;
	double                        price_open               = 5;
	double                        weighted_price           = 6;
	double                        volume                   = 7;
	int64                         position_time            = 8;
	Side                          position_side            = 9; 
	Reason                        position_reason          = 10;
	double                        sl                       = 11;
	double                        tp                       = 12;  
	double                        swap                     = 13;
	double                        trailling_percent        = 14;  
	string                        comment                  = 15;
	double                        profit_liquid            = 16;
	double                        cumulative_fees          = 17;
  repeated  Orders              Orders                   = 18;
  }

message PositionRequest { 
  Venue                        venue                  = 1;
  Product                      product                = 2;
}

message PositionsResult { 
   Retcode                      retcode                   = 1;
   repeated Position            positions                 = 2;  
   string                       comment                   = 3; 
}

message AccountRequest { 
  Venue                         venue                = 1; 
}

message AccountResult { 
   Retcode                      retcode                   = 1;  
   Account                      account                   = 2;  
   string                       comment                   = 3;
}

message ProductRequest { 
  Venue                           venue                = 1;
  Product                         product              = 2;
}

message ProductResult { 
   Retcode                      retcode                   = 1; 
   VenueProduct                 venue_products            = 2;
   string                       comment                   = 3;
}

message VenueProduct {
  bool                    enabled                   = 1;
  bool                    individual_connection     = 2;
  double                  minimum_orders_size       = 3;
  double                  step_size                 = 4;
  double                  maker_fee                 = 5;
  double                  taker_fee                 = 6;
}

message HistoricalTradesRequest { 
  Venue                          venue                = 1;
  Product                        product              = 2;
  int64                          begin                = 3;
  int64                          end                  = 4;
}

message HistoricalTradesResult { 
   Retcode                      retcode                   = 1; 
   Trade                        trades                    = 2;
   string                       comment                   = 3;
}

message User {
  string           id       = 1;
  repeated Account accounts = 2;
}

message Account {
  string                     account_id   = 1;
  AccountType                account_type = 2;
  SystemMode                 system_mode = 3;
  map<string, VenueBalance>  balances     = 4;
  bool                       active       = 5;
}

message VenueBalance {
  Venue                      id         = 1;
  map<string, Balance>       currency   = 2;
}

message Balance  {
  double     available  = 1;
  double     hold       = 2;
}

// Token
message BacktestingTokenRequest {
    repeated VenueBalance     venue_balances       = 1; 
    Subscription              subscription         = 2;
}

message BacktestingTokenResponse { 
   Retcode                      retcode                   = 1; 
   string                       token                     = 2;
   string                       comment                   = 3;
}

message BacktestingRequest {
  string                          account              = 1; 
  Subscription                    subscription         = 2;
  int64                           start_date           = 3;
  int64                           end_date             = 4;
  BacktestingCode                 code                 = 5; 
}

message BacktestingResponse { 
   Retcode                      retcode                = 1; 
   BacktestingCode              code                   = 2; 
   Trade                        trade                  = 3;
   Orderbook                    orderbook              = 4;
   string                       comment                = 5;
}

// Market Data
message Item {
  double volume = 1;
  double price  = 2;
};

message ClientInitilization {
  SystemMode      system_mode            = 1; 
  Subscription    subscription           = 2;
  int64           start_date             = 3;
  int64           end_date               = 4;  
  Granularity     candle_granularity     = 5;
  CandleGroupBy   candle_group_by        = 6;
  bool            verbose                = 7; 
}

message Subscription {
  repeated SubscriptionItems  subscribe  = 1;
}

message SubscriptionItems {
  Venue            venue         = 1;
  Product          product       = 2;
  bool             orderbook     = 3;
}

message Orderbook {
  Product           product     = 1;
  Venue             venue       = 2;
  int64             timestamp   = 3;
  int32             levels      = 4;
  repeated Item     asks        = 5;
  repeated Item     bids        = 6;
  VenueType         venue_type  = 7;
};

message Trade {
  Product         product       = 1;
  Venue           venue         = 2;
  int64           timestamp     = 3;
  double          price         = 4;
  double          size          = 5;
  Side            order_side    = 6;
  VenueType       venue_type    = 7;
  repeated Item   asks          = 8; 
  repeated Item   bids          = 9;  
};

message Ticker {
  Product     product       = 1;
  Venue       venue         = 2;
  int64       timestamp     = 3;
  double      price         = 4;
  Side        order_side    = 5;
  double      best_bid      = 6;
  double      best_ask      = 7;
  VenueType   venue_type    = 8;
};

message Candle {
  Venue         venue        = 1;
  Product       product      = 2;
  int32         granularity  = 3;
  int32         point        = 4;
  double        open         = 5;
  double        close        = 6;
  double        high         = 7;
  double        low          = 8;
  double        volume       = 9;
  double        total        = 10;
  int32         total_trades = 11;
  int32         buy_total    = 12;
  int32         sell_total   = 13;   
};

// Events
message Event {
  string       id         = 1;
  string       event      = 2;
  string       user       = 3; 
  string       account    = 4;
  string       container  = 5;
  string       strategy   = 6;
  int64        timestamp  = 7;
  string       command    = 8;
  string       message    = 9;
  bool         error      = 10;
  string       payload    = 11;      
}
