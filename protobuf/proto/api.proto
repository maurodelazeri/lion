syntax = "proto3";
package api;
import "enum.proto";


// https://www.mql5.com/en/docs/standardlibrary/tradeclasses/ctrade/ctradepositionclose

// The API service definition.
service API {   
  // Get all Order for a user with filter - A server-to-client streaming RPC.
 // rpc GetOrders(OrderFilter) returns (stream Order) {}
  // Order request - A simple RPC 
  rpc OrderSend(OrderRequest) returns (OrderResult) {}
  rpc GetPositions(PositionRequest) returns (PositionsResult) {}
  rpc GetAccount(AccountRequest) returns (AccountResult) {}
  rpc GetProductDetails(ProductRequest) returns (ProductResult) {}
  rpc GetHistoticalTrades(HistoricalTradesRequest) returns (stream HistoricalTradesResult) {}
} 

  // position — position ticket. Fill it when changing and closing a position for its clear identification. It usually matches the ticket of an order used to open the position.
  // position_by — opposite position ticket. It is used when closing a position by an opposite one (opened at the same symbol but in the opposite direction).
 
  message Orders { 
    uint64                        orders_id                = 1;  
    Venue                         venue                    = 2;  
    uint64                        account_id               = 3;  
    OrderType                     orders_type              = 4;  
    OrderState                    orders_state             = 5;  
    uint64                        time_expiration          = 6;  
    uint64                        time_setup               = 8;  
    OrderTypeFilling              orders_type_filling      = 9;  
    OrderTypeTime                 orders_type_time         = 10;  
    Reason                        orders_reason            = 11;  
    uint64                        orders_position_by_id    = 12;  
    uint64                        orders_position_id       = 13;  
    Product                       product                  = 14;  
    string                        venue_execution_id       = 15;  
    double                        volume                   = 16;  
    double                        price                    = 17;  
    double                        fee                      = 18;  
    double                        tp                       = 19;  
    double                        sl                       = 20;  
    double                        trailling_percent        = 21;  
    double                        stop_limit               = 22;  
    string                        comment                  = 23;  
   }

 message OrderRequest { 
   TradeAction                   action               = 1;  // Trade operation type 
   Venue                         venue                = 2;  // Venue where the order is being send
   Product                       product              = 3;  // Trade product
   uint64                        order                = 4;  // Order ticket 
   double                        volume               = 5;  // Requested volume for a deal in lots 
   double                        price                = 6;  // Price 
   double                        stoplimit            = 7;  // StopLimit level of the order 
   double                        sl                   = 8;  // Stop Loss level of the order 
   double                        tp                   = 9;  // Take Profit level of the order 
   double                        trailling_percent    = 10; // Once hit, follows to profit based on this percentage  
   uint64                        deviation            = 11; // Maximal possible deviation from the requested price 
   OrderType                     order_type           = 12; // Order type 
   OrderTypeFilling              order_type_filling   = 13; // Order execution type 
   OrderTypeTime                 order_type_time      = 14; // Order expiration type 
   Reason                        order_reason         = 15; // Order reason
   uint64                        expiration           = 16; // Order expiration time (for the orders of ORDER_TIME_SPECIFIED type) 
   string                        comment              = 17; // Order comment 
   uint64                        position             = 18; // Position ticket 
   uint64                        position_by          = 19; // The ticket of an opposite position
   bool                          async                = 20; // Do not wait the result response, designed to high frequency
  }

message OrderResult { 
   Retcode                      retcode                   = 1;  // Operation return code 
   Venue                        venue                     = 2;  // Venue where the order was sent
   Product                      product                   = 3;  // Product of the trade
   OrderType                    order_type                = 4;  // Order type 
   uint64                       order_id                  = 5;  // Order id placed
   uint64                       position_id               = 6;  // position id placed
   double                       volume                    = 7;  // Deal volume, confirmed by broker 
   double                       price                     = 8;  // Deal price, confirmed by broker
   string                       comment                   = 9;  // Broker comment to operation (by default it is filled by description of trade server return code) 
   string                       request_id                = 10; // Request ID set by the terminal during the dispatch  
   string                       broker_execution_id       = 11; // Return code of an external trading system 
   double                       fee                       = 12; // Trade fee
  }

message Position {
   uint64                       position_id            = 1;
   Venue                        venue                  = 2;
   uint64                       account                = 3;
   uint64                       position_time          = 4;
   Side                         position_type          = 5;
   Reason                       position_reason        = 6;
   double                       volume                 = 7;
   double                       price                  = 8;
   double                       tp                     = 9;
   double                       sl                     = 10;
   double                       swap                   = 11;
   Product                      product                = 12;
   string                       comment                = 13;
   repeated Orders              Orders                 = 14;    
  }

message PositionRequest { 
  Venue                        venue                  = 1;
  Product                      product                = 2;
}

message PositionsResult { 
   Retcode                      retcode                   = 1;
   repeated Position            positions                 = 2;  
   string                       comment                   = 3; 
}

message AccountRequest { 
  Venue                         venue                = 1; 
}

message AccountResult { 
   Retcode                      retcode                   = 1;  
   Account                      account                   = 2;  
   string                       comment                   = 3;
}

message ProductRequest { 
  Venue                           venue                = 1;
  Product                         product              = 2;
}

message ProductResult { 
   Retcode                      retcode                   = 1; 
   VenueProduct                 venue_products            = 2;
   string                       comment                   = 3;
}

message VenueProduct {
  bool                    enabled                   = 1;
  bool                    individual_connection     = 2;
  double                  minimum_orders_size       = 3;
  double                  step_size                 = 4;
  double                  maker_fee                 = 5;
  double                  taker_fee                 = 6;
}

message HistoricalTradesRequest { 
  Venue                           venue                = 1;
  Product                         product              = 2;
  uint64                          begin                = 3;
  uint64                          end                  = 4;
}

message HistoricalTradesResult { 
   Retcode                      retcode                   = 1; 
   Trade                        trades                    = 2;
   string                       comment                   = 3;
}

message User {
  string           id       = 1;
  repeated Account accounts = 2;
}

message Account {
  uint32                account_id   = 1;
  uint32                user_id      = 2;
  Venue                 venue        = 3;
  AccountType           account_type = 4;
  AccountMode           account_mode = 5;
  map<string, Balance>  balances     = 6;
  bool                  active       = 7;
}

message Balance {
  double  balance_id = 1;
  double  available  = 2;
  double  hold       = 3;
}

// Market Data
message Item {
  double amount = 1;
  double price  = 2;
};


message Subscription {
  repeated SubscriptionItems  subscribe          = 1;
  CandleGroupBy               candle_group_by    = 2;
}

message SubscriptionItems {
  Venue            venue         = 1;
  Product          product       = 2;
  bool             orderbook     = 3;
}

message Orderbook {
  Product           product     = 1;
  Venue             venue       = 2;
  uint64            timestamp   = 3;
  uint32            levels      = 4;
  repeated Item     asks        = 5;
  repeated Item     bids        = 6;
  VenueType         venue_type  = 7;
};

message Trade {
  Product     product       = 1;
  Venue       venue         = 2;
  uint64      timestamp     = 3;
  double      price         = 4;
  double      size          = 5;
  Side        order_side    = 6;
  VenueType   venue_type    = 7;
};

message Ticker {
  Product     product       = 1;
  Venue       venue         = 2;
  uint64      timestamp     = 3;
  double      price         = 4;
  Side        order_side    = 5;
  double      best_bid      = 6;
  double      best_ask      = 7;
  VenueType   venue_type    = 8;
};

message Candle {
  Venue         venue        = 1;
  Product       product      = 2;
  int32         granularity  = 3;
  int32         point        = 4;
  double        open         = 5;
  double        close        = 6;
  double        high         = 7;
  double        low          = 8;
  double        volume       = 9;
  double        total        = 10;
  int32         total_trades = 11;
  int32         buy_total    = 12;
  int32         sell_total   = 13;   
};

// Events
message Event {
  string       id         = 1;
  string       event      = 2;
  string       user       = 3; 
  string       account    = 4;
  string       container  = 5;
  string       strategy   = 6;
  int64        timestamp  = 7;
  string       command    = 8;
  string       message    = 9;
  bool         error      = 10;
  string       payload    = 11;      
}
